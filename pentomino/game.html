<!doctype html>

<title>Penta Game</title>

<style>

    @import "game_styles.css";
    /* @import "tile-debug.css"; */
    @import "colors.css";

.root {
    display: flex;
}

.field {
    margin: auto auto;
}

body {
    background-color: black;
}

.game-container {
    /* background-color: #a2acd8; */
    background-color: #ccc;
    margin-top: 20px;
    padding: 12px;
    width: 510px;
    height: 510px;
    border-radius: 6px;
}

.grid-container {
    position: absolute;
    z-index: 1;
}

.grid-row {
    display: flex;
    margin-bottom: 12px;
}
.grid-cell {
    border-radius: 6px;
    /* background-color: black; */
    margin-right: 12px;
    height: 53px;
    width: 53px;
}

.grid-cell:last-child {
    margin-right: 0;
}

.tile-container {
    z-index: 2;
    position: relative;
}

.tile {
    position: absolute;
    z-index: 4;
    width: 55px;
    height: 55px;
    border-radius: 6px;
    /* animation: appear 200ms ease 100ms; */
    transition: 100ms ease-in-out;
    line-height: 55px;
    text-align: center;
    font-family: monospace;
    font-size: 1.2rem;
    color: white;

    border: 2px black solid;
}

color-

</style>

<div class="root">
<div class="field">
    <div class="game-container">
        <div class="grid-container">
            <div class="grid-row">
                <div class="grid-cell"></div>
                <div class="grid-cell"></div>
                <div class="grid-cell"></div>
                <div class="grid-cell"></div>
                <div class="grid-cell"></div>
                <div class="grid-cell"></div>
                <div class="grid-cell"></div>
                <div class="grid-cell"></div>
            </div>
            <div class="grid-row">
                <div class="grid-cell"></div>
                <div class="grid-cell"></div>
                <div class="grid-cell"></div>
                <div class="grid-cell"></div>
                <div class="grid-cell"></div>
                <div class="grid-cell"></div>
                <div class="grid-cell"></div>
                <div class="grid-cell"></div>
            </div>
            <div class="grid-row">
                <div class="grid-cell"></div>
                <div class="grid-cell"></div>
                <div class="grid-cell"></div>
                <div class="grid-cell"></div>
                <div class="grid-cell"></div>
                <div class="grid-cell"></div>
                <div class="grid-cell"></div>
                <div class="grid-cell"></div>
            </div>
            <div class="grid-row">
                <div class="grid-cell"></div>
                <div class="grid-cell"></div>
                <div class="grid-cell"></div>
                <div class="grid-cell"></div>
                <div class="grid-cell"></div>
                <div class="grid-cell"></div>
                <div class="grid-cell"></div>
                <div class="grid-cell"></div>
            </div>
            <div class="grid-row">
                <div class="grid-cell"></div>
                <div class="grid-cell"></div>
                <div class="grid-cell"></div>
                <div class="grid-cell"></div>
                <div class="grid-cell"></div>
                <div class="grid-cell"></div>
                <div class="grid-cell"></div>
                <div class="grid-cell"></div>
            </div>
            <div class="grid-row">
                <div class="grid-cell"></div>
                <div class="grid-cell"></div>
                <div class="grid-cell"></div>
                <div class="grid-cell"></div>
                <div class="grid-cell"></div>
                <div class="grid-cell"></div>
                <div class="grid-cell"></div>
                <div class="grid-cell"></div>
            </div>
            <div class="grid-row">
                <div class="grid-cell"></div>
                <div class="grid-cell"></div>
                <div class="grid-cell"></div>
                <div class="grid-cell"></div>
                <div class="grid-cell"></div>
                <div class="grid-cell"></div>
                <div class="grid-cell"></div>
                <div class="grid-cell"></div>
            </div>
            <div class="grid-row">
                <div class="grid-cell"></div>
                <div class="grid-cell"></div>
                <div class="grid-cell"></div>
                <div class="grid-cell"></div>
                <div class="grid-cell"></div>
                <div class="grid-cell"></div>
                <div class="grid-cell"></div>
                <div class="grid-cell"></div>
            </div>
        </div>

        <div id="tile-container" class="tile-container">
        </div>
    </div>
</div>
</div>

<script>
    // L, N, P, F, Y, T, V, U, W, Z, I, X 

    function shuffle(array) {
        let currentIndex = array.length;

        // While there remain elements to shuffle...
        while (currentIndex != 0) {

            // Pick a remaining element...
            let randomIndex = Math.floor(Math.random() * currentIndex);
            currentIndex--;

            // And swap it with the current element.
            [array[currentIndex], array[randomIndex]] = [
                array[randomIndex], array[currentIndex]];
        }
    }

    function randInt(max) {
        return Math.floor(Math.random() * max);
    }    

    var colors = ["U", 0, 0, 0,
    1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12,
    1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12,
    1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12,
    1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12,
    1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12]

    shuffle(colors)

    
    function swap(i, j) {
        console.log("swap", i, j)
        let temp = colors[i];
        colors[i] = colors[j];
        colors[j] = temp;
    }
    
    swap(colors.findIndex(el => el == 0), 63)
    swap(colors.findIndex(el => el == 0), 62)
    swap(colors.findIndex(el => el == 0), 61)
    swap(62, 7 * 8)
    swap(61, 7)

    swap(colors.findIndex(el => el == 'U'), 0)


    container = document.getElementById('tile-container')

    function draw() {
    for (let i = 0; i < 64; i++) {
        if (colors[i] != "U") {
        let el = document.createElement('div')
        el.className = `tile tile-${Math.floor(i / 8) + 1}-${i % 8 + 1} color-${colors[i]}`
        container.appendChild(el)
        }
    }}
    draw()

    function userPosition() {
        let index = colors.findIndex(el => el == "U")
        let y = Math.floor(index / 8) + 1
        let x = index % 8 + 1
        return {x, y}
    }

    function canMove(pos) {
        if (pos.x < 1 || pos.x > 8)
          return false
        if (pos.y < 1 || pos.y > 8)
          return false
        let index = (pos.x - 1) + (pos.y - 1) * 8;
        if (colors[index] == 0)
          return false
        return true
    }

    function move(a, b) {
        ai = (a.y - 1) * 8 + (a.x - 1)
        bi = (b.y - 1) * 8 + (b.x - 1)

        console.log(a, ai, colors[ai])
        console.log(b, bi, colors[bi])

        let temp = colors[ai]
        console.log(ai, colors[ai], bi, colors[bi])
        colors[ai] = colors[bi]
        colors[bi] = temp
        console.log(colors)

        let aclass = `tile-${a.y}-${a.x}`
        let bclass = `tile-${b.y}-${b.x}`
        let atile = document.getElementsByClassName(aclass)[0]
        let btile = document.getElementsByClassName(bclass)[0]


        if (atile)
          atile.className = atile.className.replace(aclass, bclass)

        if (btile)
          btile.className = btile.className.replace(bclass, aclass)

        console.log(atile)
        console.log(btile)

    }

    document.body.onkeydown = e => {
        pos = userPosition();

        console.log("user position", pos)

        if ( e.key == 'ArrowUp') {
            console.log("up")
            let = newPos = {x: pos.x, y: pos.y + 1}
            if (canMove(newPos)) {
                console.log("swap", pos, newPos);
                move(pos, newPos)
            }
        }
        else if ( e.key == 'ArrowDown') {
            console.log("down")
            let = newPos = {x: pos.x, y: pos.y - 1}
            if (canMove(newPos)) {
                console.log("swap", pos, newPos);
                move(pos, newPos)
            }
        }
        else if (e.key == 'ArrowLeft') {
            console.log("left")
            let = newPos = {x: pos.x + 1, y: pos.y}
            if (canMove(newPos)) {
                console.log("swap", pos, newPos);
                move(pos, newPos)
            }
        }
        else if (e.key == 'ArrowRight') {
            console.log("right")
            let = newPos = {x: pos.x - 1, y: pos.y}
            if (canMove(newPos)) {
                console.log("swap", pos, newPos);
                move(pos, newPos)
            }
        }
    }

</script>